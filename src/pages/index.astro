---
import { Image } from "astro:assets";
import { type CollectionEntry, getCollection } from "astro:content";
import Card from "@/components/Card.astro";
import PostPreview from "@/components/blog/PostPreview.astro";
import Note from "@/components/note/Note.astro";
import { getAllPosts } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";
import headshot from "@/assets/img/headshot.png";

// Posts
const MAX_POSTS = 10;
const allPosts = await getAllPosts();
const allPostsByDate = allPosts
	.sort(collectionDateSort)
	.slice(0, MAX_POSTS) as CollectionEntry<"post">[];

// Notes
const MAX_NOTES = 3;
const allNotes = await getCollection("note");
const latestNotes = allNotes.sort(collectionDateSort).slice(0, MAX_NOTES);

// Projects
const projects = [
	{
		title: "Google clone",
		to: "/posts/google-clone/",
		description: "Search with Google API",
	},
	{
		title: "Panic theme",
		to: "https://github.com/kirso/logseq-panic-theme",
		description: "Make Logseq PKM pretty",
	},
	{
		title: "Schwiftyverse",
		to: "https://schwiftyverse.vercel.app/",
		description: "GIFs on Solana blockchain",
	},
	{
		title: "ToDo",
		to: "https://github.com/kirso/bun-elysia-tailwind-htmx-todo-app",
		description: "Tasks on the edge",
	},
];
---

<PageLayout meta={{ title: "Home" }}>
  <!-- Hero -->
  <header class="mb-12">
    <div class="flex flex-col gap-6 sm:flex-row sm:items-start sm:gap-8">
      <Image
        src={headshot}
        alt="Kirill So"
        width={96}
        height={96}
        class="h-24 w-24 rounded-full object-cover grayscale"
      />
      <div class="flex-1">
        <p class="leading-relaxed">
          Hi, I'm Kirill. Currently on sabbatical and in exploration mode. Previously, I was a principal product manager at Delivery Hero, where I shipped growth features that drove millions in revenue.
        </p>
        <p class="mt-4 leading-relaxed">
          I write about life experiences and digital products. In my free time I weightlift, play tennis, and travel with my <a class="link font-medium" href="https://sarahkhanamajid.com/" target="_blank" rel="noopener">wife</a>.
        </p>
      </div>
    </div>
    <nav class="mt-6 flex flex-wrap gap-x-4 gap-y-2 text-sm">
      <a class="link" href="https://twitter.com/kirso_" target="_blank" rel="noopener">Twitter</a>
      <span class="text-text-tertiary">/</span>
      <a class="link" href="https://github.com/kirso" target="_blank" rel="noopener">GitHub</a>
      <span class="text-text-tertiary">/</span>
      <a class="link" href="https://www.linkedin.com/in/kirso_" target="_blank" rel="noopener">LinkedIn</a>
      <span class="text-text-tertiary">/</span>
      <a class="link" href="https://kirill.substack.com" target="_blank" rel="noopener">Newsletter</a>
      <span class="text-text-tertiary">/</span>
      <a class="link" href="mailto:kirso@hey.com">Email</a>
      <span class="text-text-tertiary">/</span>
      <a class="link" href="/cv.pdf" download>CV ↓</a>
    </nav>
  </header>

  <!-- Posts -->
  <section class="mb-16">
    <div class="mb-6 flex items-baseline justify-between">
      <p class="section-label">Posts</p>
      <a class="arrow-link" href="/posts/">
        View all <span aria-hidden="true">→</span>
      </a>
    </div>
    <ul class="space-y-3">
      {
        allPostsByDate.map((p) => (
          <li class="flex flex-col gap-1 sm:flex-row sm:items-baseline sm:gap-4">
            <PostPreview post={p} />
          </li>
        ))
      }
    </ul>
  </section>

  <!-- Notes -->
  {
    latestNotes.length > 0 && (
      <section class="mb-16">
        <div class="mb-6 flex items-baseline justify-between">
          <p class="section-label">Notes</p>
          <a class="arrow-link" href="/notes/">
            View all <span aria-hidden="true">→</span>
          </a>
        </div>
        <ul class="space-y-6">
          {latestNotes.map((note) => (
            <li>
              <Note note={note} as="h3" isPreview />
            </li>
          ))}
        </ul>
      </section>
    )
  }

  <!-- Projects -->
  <section class="mb-16">
    <div class="mb-6 flex items-baseline justify-between">
      <p class="section-label">Projects</p>
    </div>
    <div class="divide-y divide-border border border-border">
      {projects.map((project) => <Card {...project} />)}
    </div>
  </section>
</PageLayout>

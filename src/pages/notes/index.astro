---
import { getCollection } from "astro:content";
import Note from "@/components/note/Note.astro";
import PageLayout from "@/layouts/Base.astro";
import Schema from "@/components/Schema.astro";
import { collectionDateSort } from "@/utils/date";

const MAX_NOTES_PER_PAGE = 10;
const allNotes = await getCollection("note");
const sortedNotes = allNotes.sort(collectionDateSort).slice(0, MAX_NOTES_PER_PAGE);
const totalNotes = allNotes.length;

const meta = {
	description:
		"A collection of Notes on everything from tech to philosophy—brief, raw, and evolving reflections in progress",
	title: "Notes",
};
---

<PageLayout meta={meta}>
  <Schema type="breadcrumb" breadcrumbs={[
    { name: "Home", url: "/" },
    { name: "Notes", url: "/notes/" }
  ]} />
  <header class="mb-12">
    <h1 class="page-title">Notes</h1>
    <p class="mt-2 text-text-secondary">{totalNotes} notes collected</p>
  </header>

  <section>
    <div class="section-rule"><span>Recent thoughts</span></div>
    <ul class="space-y-8">
      {
        sortedNotes.map((note) => (
          <li>
            <Note note={note} as="h2" isPreview />
          </li>
        ))
      }
    </ul>
    {
      sortedNotes.length >= MAX_NOTES_PER_PAGE && (
        <nav class="mt-12">
          <a class="arrow-link" href="/notes/page/2/">
            More notes <span aria-hidden="true">→</span>
          </a>
        </nav>
      )
    }
  </section>
</PageLayout>

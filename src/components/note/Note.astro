---
import { type CollectionEntry, render } from "astro:content";
import type { HTMLTag, Polymorphic } from "astro/types";
import FormattedDate from "@/components/FormattedDate.astro";

type Props<Tag extends HTMLTag> = Polymorphic<{ as: Tag }> & {
	note: CollectionEntry<"note">;
	isPreview?: boolean | undefined;
};

const { as: Tag = "div", note, isPreview = false } = Astro.props;
const { Content } = await render(note);
---

{isPreview ? (
  <!-- Preview: Entire card is clickable -->
  <a href={`/notes/${note.id}/`} class="note-card block group">
    <div class="flex items-baseline gap-2 mb-1 flex-wrap">
      <Tag class="font-medium group-hover:text-global-text transition-colors">
        {note.data.title}
      </Tag>
      <span class="text-text-tertiary">Â·</span>
      <FormattedDate
        class="mono text-text-tertiary"
        style="font-size: var(--text-micro);"
        date={note.data.publishDate}
      />
    </div>
    <div
      class="prose prose-sm mt-2 max-w-none line-clamp-3 [&>p:last-of-type]:mb-0 [&>blockquote:first-child]:mt-0 text-text-secondary">
      <Content />
    </div>
  </a>
) : (
  <!-- Full page view -->
  <article data-pagefind-body>
    <Tag class="page-title mb-2">{note.data.title}</Tag>
    <FormattedDate
      class="mono text-text-tertiary"
      style="font-size: var(--text-micro);"
      date={note.data.publishDate}
    />
    <div class="prose prose-sm mt-6 max-w-none [&>p:last-of-type]:mb-0 [&>blockquote:first-child]:mt-0">
      <Content />
    </div>
  </article>
)}

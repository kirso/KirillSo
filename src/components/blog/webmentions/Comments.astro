---
/** Editorial Minimalism Comments - no icons, clean typography **/
import { Image } from "astro:assets";
import type { WebmentionsChildren } from "@/types";

interface Props {
	mentions: WebmentionsChildren[];
}

const { mentions } = Astro.props;

const validComments = ["mention-of", "in-reply-to"];

const comments = mentions.filter(
	(mention) => validComments.includes(mention["wm-property"]) && mention.content?.text,
);
---

{
  !!comments.length && (
    <div>
      <p class="mb-4 text-sm text-text-secondary">
        {comments.length} mention{comments.length > 1 ? "s" : ""}
      </p>
      <ul class="mt-0 divide-y divide-border ps-0" role="list">
        {comments.map((mention) => (
          <li class="p-comment h-cite my-0 flex items-start gap-x-4 py-5">
            {mention.author?.photo && mention.author.photo !== "" ? (
              mention.author.url && mention.author.url !== "" ? (
                <a
                  class="u-author not-prose shrink-0 overflow-hidden rounded-full"
                  href={mention.author.url}
                  rel="noreferrer"
                  target="_blank"
                  title={mention.author.name}
                >
                  <Image
                    alt={mention.author?.name}
                    class="u-photo my-0 h-10 w-10"
                    height={40}
                    src={mention.author?.photo}
                    width={40}
                  />
                </a>
              ) : (
                <Image
                  alt={mention.author?.name}
                  class="u-photo my-0 h-10 w-10 rounded-full"
                  height={40}
                  src={mention.author?.photo}
                  width={40}
                />
              )
            ) : null}
            <div class="flex-auto">
              <div class="p-author h-card flex items-center justify-between gap-x-2">
                <p class="p-name my-0 line-clamp-1 font-medium">
                  {mention.author?.name}
                </p>
                <a
                  aria-label="View source"
                  class="u-url not-prose link-muted text-sm"
                  href={mention.url}
                  rel="noreferrer"
                  target="_blank"
                >
                  â†—
                </a>
              </div>
              <p class="comment-content mt-1 mb-0 break-words text-sm text-text-secondary [word-break:break-word]">
                {mention.content?.text}
              </p>
            </div>
          </li>
        ))}
      </ul>
    </div>
  )
}

---
/**
 * Classic Paper Blog Header
 * - Site name on left
 * - Slash-separated navigation on right
 * - Clean, simple, 2000s blog aesthetic
 */
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
---

<header class="mb-12 flex items-center justify-between border-b border-border pb-8" id="main-header">
  <a
    aria-current={Astro.url.pathname === "/" ? "page" : false}
    href="/"
  >
    {
      Astro.url.pathname === "/" ? (
        <h1 class="font-semibold tracking-tight" style="font-size: var(--text-large);">Kirill So</h1>
      ) : (
        <span class="font-semibold tracking-tight" style="font-size: var(--text-large);">Kirill So</span>
      )
    }
  </a>

  <div class="flex items-center gap-4">
    <!-- Desktop nav with slashes -->
    <nav
      aria-label="Main menu"
      class="hidden items-center sm:flex"
      id="navigation-menu"
    >
      {
        menuLinks.map((link, index) => (
          <>
            {index > 0 && <span class="mx-2 text-text-tertiary">/</span>}
            <a
              aria-current={Astro.url.pathname === link.path ? "page" : false}
              class:list={[
                "transition-colors",
                Astro.url.pathname === link.path
                  ? "text-global-text underline underline-offset-4"
                  : "link-nav"
              ]}
              style="font-size: var(--text-body);"
              data-astro-prefetch
              href={link.path}
            >
              {link.title.toLowerCase()}
            </a>
          </>
        ))
      }
    </nav>

    <Search />
    <ThemeToggle />

    <!-- Mobile menu button -->
    <mobile-button class="sm:hidden">
      <button
        aria-expanded="false"
        aria-haspopup="menu"
        class="relative h-6 w-6 text-text-secondary transition-colors hover:text-global-text"
        id="toggle-navigation-menu"
        type="button"
      >
        <span class="sr-only">Open main menu</span>
        <svg
          aria-hidden="true"
          class="absolute inset-0 h-full w-full transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
          fill="none"
          focusable="false"
          stroke="currentColor"
          stroke-width="1.5"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M3.75 9h16.5m-16.5 6.75h16.5"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>
    </mobile-button>
  </div>
</header>

<!-- Mobile menu (slides down) -->
<nav
  aria-label="Mobile menu"
  class="group fixed inset-x-0 top-0 z-50 hidden bg-global-bg px-5 py-4 shadow-sm"
  id="mobile-menu"
>
  <div class="flex items-center justify-between">
    <a href="/" class="font-semibold tracking-tight" style="font-size: var(--text-large);">Kirill So</a>
    <button
      class="text-text-secondary hover:text-global-text"
      id="close-mobile-menu"
      type="button"
    >
      <span class="sr-only">Close menu</span>
      <svg
        class="h-6 w-6"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        viewBox="0 0 24 24"
      >
        <path
          d="M6 18L18 6M6 6l12 12"
          stroke-linecap="round"
          stroke-linejoin="round"></path>
      </svg>
    </button>
  </div>
  <div class="mt-6 flex flex-col gap-4">
    {
      menuLinks.map((link) => (
        <a
          class="link-nav"
          style="font-size: var(--text-large);"
          href={link.path}
        >
          {link.title.toLowerCase()}
        </a>
      ))
    }
  </div>
</nav>

<script>
  class MobileNavBtn extends HTMLElement {
    connectedCallback() {
      const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");
      const mobileMenu = document.getElementById("mobile-menu");
      const closeBtn = document.getElementById("close-mobile-menu");

      mobileButtonEl?.addEventListener("click", () => {
        mobileMenu?.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      });

      closeBtn?.addEventListener("click", () => {
        mobileMenu?.classList.add("hidden");
        document.body.style.overflow = "";
      });

      // Close on link click
      mobileMenu?.querySelectorAll("a").forEach((link) => {
        link.addEventListener("click", () => {
          mobileMenu?.classList.add("hidden");
          document.body.style.overflow = "";
        });
      });
    }
  }

  customElements.define("mobile-button", MobileNavBtn);
</script>
